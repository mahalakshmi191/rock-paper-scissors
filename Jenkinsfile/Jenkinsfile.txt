pipeline {
    agent any

    environment {
        TOMCAT_URL = 'http://localhost:8080/manager/text'
        TOMCAT_CRED = credentials('tomcat-admin-cred')  // Jenkins credentials ID
        WAR_NAME = 'roshambo.war'
        WAR_PATH = "C:/Users/Admin/rock-paper-scissors/target/${WAR_NAME}"
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        // Optional: Clean & build if you want to refresh the WAR
         stage('Build') {
            steps {
               sh "mvn clean package"
           }
        }

        stage('Undeploy Old App') {
            steps {
                sh """
                    curl -u ${TOMCAT_CRED_USR}:${TOMCAT_CRED_PSW} \
                    "${TOMCAT_URL}/undeploy?path=/myapp"
                """
            }
        }

        stage('Deploy New WAR') {
            steps {
                sh """
                    curl -u ${TOMCAT_CRED_USR}:${TOMCAT_CRED_PSW} \
                    --upload-file "${WAR_PATH}" \
                    "${TOMCAT_URL}/deploy?path=/myapp&update=true"
                """
            }
        }
    }

    post {
        success {
            echo "Deployment completed successfully!"
        }
        failure {
            echo "Deployment failed."
        }
    }
}
